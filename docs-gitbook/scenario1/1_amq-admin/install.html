
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Deploying the core infrastructure Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../2_tenant/configure.html" />
    
    
    <link rel="prev" href="../0_ocp-admin/install.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Intro</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Scenario 1 - AMQP</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../scenario1.html">
            
                <a href="../scenario1.html">
            
                    
                    Statement Of Work
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../0_ocp-admin/install.html">
            
                <a href="../0_ocp-admin/install.html">
            
                    
                    Installing via the Operator
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.3" data-path="install.html">
            
                <a href="install.html">
            
                    
                    Deploying the core infrastructure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../2_tenant/configure.html">
            
                <a href="../2_tenant/configure.html">
            
                    
                    Configuring a tenant
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Scenario 2 - IoT</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../scenario2/scenario2.html">
            
                <a href="../../scenario2/scenario2.html">
            
                    
                    Statement Of Work
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../scenario2/0_ocp-admin/install.html">
            
                <a href="../../scenario2/0_ocp-admin/install.html">
            
                    
                    Installing via the Operator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../scenario2/1_amq-admin/install.html">
            
                <a href="../../scenario2/1_amq-admin/install.html">
            
                    
                    Deploying the core infrastructure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../../scenario2/2_tenant/configure.html">
            
                <a href="../../scenario2/2_tenant/configure.html">
            
                    
                    Configuring a tenant
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">The Cloud Native integration layer!</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../todo.adoc">
            
                <span>
            
                    
                    TODO
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Deploying the core infrastructure</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="as-an-amq-online-system-admin-deploying-the-core-infrastructure">As an AMQ Online System Admin; Deploying the core infrastructure</h1>
<div class="sect1">
<h2 id="_customer_brief">Customer Brief</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You work for Red Hat as a Middleware Consultant. Your customer, EPHT, has purchased a subscription for AMQ Online as the
account team has told them that; <em>&quot;AMQ Online is the best thing since sliced bread&quot;</em>.
Self-service, cloud native, multi tenant messaging; they love it!</p>
</div>
<div class="paragraph">
<p>EPHT want to offer AMQ Online to their internal customers in development but since its their first deployment,
they want to keep it simple and have raised the following JIRA tickets.</p>
</div>
<div class="paragraph">
<p><strong>CONFIGURE AUTHENTICATION SERVICE; <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.3/html/installing_and_managing_amq_online_on_openshift_container_platform/configuring-messaging#con-authentication-services-messaging" target="_blank">docs</a></strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>AS A messaging administrator
I WANT TO have authentication enabled on the AMQ Online cluster via the Standard AuthenticationService
SO THAT only those allowed can access the cluster</pre>
</div>
</div>
<div class="paragraph">
<p><strong>SET RESOURCE USAGE TO LOW IN DEV; <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.3/html/installing_and_managing_amq_online_on_openshift_container_platform/configuring-messaging#applying-infra-config-changes-messaging" target="_blank">docs</a></strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>AS A messaging administrator
I WANT TO configure the StandardInfraConfig router and broker &apos;resources&apos; to use as little memory as possible
SO THAT the cluster resource usage is low and we stay within budget</pre>
</div>
</div>
<div class="paragraph">
<p><strong>SET PAGING BEHAVIOUR TO BLOCK; <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.3/html/installing_and_managing_amq_online_on_openshift_container_platform/configuring-messaging#create-address-space-plans-cli-messaging" target="_blank">docs</a></strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>AS A messaging administrator
I WANT TO configure the StandardInfraConfig broker &apos;addressFullPolicy&apos; to block
SO THAT to control resource usage</pre>
</div>
</div>
<div class="paragraph">
<p><strong>CONFIGURE ADDRESS SPACE PLAN TO HAVE A PRIMARY AMQP TARGET USE CASE; <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.3/html/installing_and_managing_amq_online_on_openshift_container_platform/configuring-messaging#create-address-space-plans-cli-messaging" target="_blank">docs</a></strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>AS A messaging administrator
I WANT TO configure the AddressSpacePlan &apos;addressSpaceType&apos; to be used primarily by AMQP users
SO THAT we dont offer JMS support in this address plan</pre>
</div>
</div>
<div class="paragraph">
<p><strong>CONFIGURE ADDRESS SPACE PLAN HAVE CAPACITY FOR MULTIPLE ADDRESSES; <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.3/html/installing_and_managing_amq_online_on_openshift_container_platform/configuring-messaging#create-address-space-plans-cli-messaging" target="_blank">docs</a></strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>AS A messaging administrator
I WANT TO configure the AddressSpacePlan &apos;resourceLimits&apos; to have enough resources for multiple address plans
SO THAT we only need to support 1 plan within development</pre>
</div>
</div>
<div class="paragraph">
<p><strong>CONFIGURE ADDRESS PLAN WHICH IS PARTITIONED; <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.3/html/installing_and_managing_amq_online_on_openshift_container_platform/configuring-messaging#con-address-plans-messaging" target="_blank">docs</a></strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>AS A messaging administrator
I WANT TO configure the AddressPlan &apos;partitions&apos; to be an odd number
SO THAT the address which subscribes to &apos;queue-partitioned&apos; is HA</pre>
</div>
</div>
<div class="paragraph">
<p><strong>CONFIGURE ADDRESS PLAN WHICH IS QUEUE BASED; <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.3/html/installing_and_managing_amq_online_on_openshift_container_platform/configuring-messaging#con-address-plans-messaging" target="_blank">docs</a></strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>AS A messaging administrator
I WANT TO configure the AddressPlan &apos;addressType&apos; to queue based
SO THAT cluster offers these semantics via &apos;queue-lowresources&apos;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>CONFIGURE ADDRESS PLAN WHICH IS ANYCAST BASED; <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.3/html/installing_and_managing_amq_online_on_openshift_container_platform/configuring-messaging#con-address-plans-messaging" target="_blank">docs</a></strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>AS A messaging administrator
I WANT TO configure the AddressPlan &apos;addressType&apos; to anycast based
SO THAT cluster offers these semantics via &apos;anycast-lowresources&apos;</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You think everything is deployed and working? Check the logs of the &apos;address-space-controller&apos;:
     oc logs $(oc get pods -n $OPERATOR_NS -l name=address-space-controller -o jsonpath=&apos;{.items[0].metadata.name}&apos;) -n $OPERATOR_NS
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_do_i_do_that">How do I do that?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A starting point for <a href="templates">YAML templates</a> has been provided but some have missing properties.
Follow the docs provided and update the YAML. Once you have applied the YAML to the cluster, you should see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc apply <span class="hljs-_">-f</span> lab/scenario1/1_amq-admin/templates -n <span class="hljs-variable">$OPERATOR_NS</span>
authenticationservice.admin.enmasse.io/standard-authservice created
standardinfraconfig.admin.enmasse.io/lowresources created
addressspaceplan.admin.enmasse.io/standarddev created
addressplan.admin.enmasse.io/queue-partitioned created
addressplan.admin.enmasse.io/anycast-lowresources created
addressplan.admin.enmasse.io/queue-lowresources created

$ oc get pods -n <span class="hljs-variable">$OPERATOR_NS</span>
NAME                                        READY   STATUS    RESTARTS   AGE
enmasse-operator-85f495<span class="hljs-built_in">fc</span>7c-fzq8t           1/1     Running   0          43m
address-space-controller-779b646cb9-cqs5p   1/1     Running   0          43m
api-server-9<span class="hljs-built_in">fc</span>7bf698-4btgd                  1/1     Running   0          43m
user-api-server-556d984467-27xsd            1/1     Running   0          43m
console-b468bbb74-7l24d                     2/2     Running   0          42m
standard-authservice-77859d9ccb-2grlg       1/1     Running   0          6m8s</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_next">Whats next?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once the AMQ Online core infrastructure is deployed correctly, move onto the deploying the AMQ Online <a href="../2_tenant/configure.html">tenant infrastructure</a>.</p>
</div>
</div>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../0_ocp-admin/install.html" class="navigation navigation-prev " aria-label="Previous page: Installing via the Operator">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../2_tenant/configure.html" class="navigation navigation-next " aria-label="Next page: Configuring a tenant">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Deploying the core infrastructure","level":"2.3","depth":1,"next":{"title":"Configuring a tenant","level":"2.4","depth":1,"path":"scenario1/2_tenant/configure.adoc","ref":"scenario1/2_tenant/configure.adoc","articles":[]},"previous":{"title":"Installing via the Operator","level":"2.2","depth":1,"path":"scenario1/0_ocp-admin/install.adoc","ref":"scenario1/0_ocp-admin/install.adoc","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"scenario1/1_amq-admin/install.adoc","mtime":"2019-06-19T13:14:01.214Z","type":"asciidoc","time":""},"gitbook":{"path":"scenario1/1_amq-admin/install.adoc","mtime":"2019-06-19T13:14:01.214Z","type":"asciidoc","time":""},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

